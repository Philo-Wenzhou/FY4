# FY-4B 卫星异常热点检测系统

## 概述

本系统基于风云4B（FY-4B）卫星数据，实现了异常热点（如森林火灾）的自动检测和识别。系统整合了文献中的多种火点识别方法，包括亮温阈值法、太阳天顶角校正和空间差异分析法，能够有效地区分真实火点和背景噪声。

## 系统功能

1. **数据读取与处理**：自动读取FY-4B GEO和L1数据文件
2. **太阳天顶角校正**：根据太阳天顶角区分白天和夜间，应用不同的检测策略
3. **多通道数据融合**：使用3.7μm和10.8μm红外通道进行火点识别
4. **空间异常检测**：通过3×3滑动窗口计算空间差异，提高检测精度
5. **结果可视化**：生成多种可视化结果，包括亮温图、火点分布图、火点掩膜和太阳天顶角图
6. **数据导出**：将检测到的火点位置和亮温信息保存为CSV文件

## 技术原理

### 火点识别算法

本系统综合了以下文献中的火点识别方法：
- 《基于FY-3D_MERSI数据的火点识别方法研究》（殷针针）
- 《基于FY4遥感数据的森林火灾判别研究》（熊得祥）
- 《基于风云卫星数据的火情监测研究》

核心识别策略包括：

1. **亮温阈值法**：
   - 夜间（太阳天顶角 > 110°）：3.7μm通道亮温 ≥ 320K
   - 白天（太阳天顶角 ≤ 110°）：3.7μm通道亮温 ≥ 340K

2. **空间差异法**：
   - 使用3×3滑动窗口计算中心像元与周围像元的最大温差
   - 温差 > 10K 作为火点的附加判定条件

### 数据流程

1. 读取GEO文件获取经纬度和太阳天顶角数据
2. 读取L1文件获取红外通道数据（3.7μm和10.8μm）
3. 对通道数据进行定标，转换为亮温
4. 将所有数据重投影到统一的地理网格
5. 计算空间差异
6. 应用火点检测算法
7. 提取和保存火点信息
8. 生成可视化结果

## 系统配置

### 环境要求

- Python 3.6+
- 依赖库：numpy, h5py, matplotlib, cartopy, scipy, pandas

### 目录结构

```
E:/FY4BPro/
├── data/             # FY-4B卫星数据（GEO和L1文件）
└── fire/             # 本系统代码和输出
    ├── fire_hot.py           # 主程序文件
    ├── test_hotspot_detection.py  # 测试脚本
    ├── output_hotspots/      # 输出目录
    └── README异常热点检测.md   # 本文档
```

### 参数配置

在`fire_hot.py`文件中，可以根据需要调整以下参数：

```python
# 数据文件路径
DATA_DIR = 'E:/FY4BPro/data/'
geo_file = os.path.join(DATA_DIR, '你的GEO文件名.HDF')
data_file = os.path.join(DATA_DIR, '你的L1文件名.HDF')

# 火点检测阈值参数
BT37_NIGHT_THRESHOLD = 320  # 夜间3.7μm通道亮温阈值(K)
BT37_DAY_THRESHOLD = 340    # 白天3.7μm通道亮温阈值(K)
SUN_ZENITH_THRESHOLD = 110  # 太阳天顶角阈值(°)，大于此值认为是夜间
DT_THRESHOLD = 10           # 空间差异阈值(K)

# 中国区域范围（网格参数）
x_min, x_max = 18, 54  # 纬度范围
y_min, y_max = 72, 136  # 经度范围
step = 0.04  # 网格步长
```

## 使用方法

### 1. 准备数据

将FY-4B的GEO和L1数据文件放入`E:/FY4BPro/data/`目录中。确保文件名格式正确，以便程序能够正确读取。

### 2. 运行测试脚本（可选）

首先运行测试脚本，检查数据文件是否可用：

```bash
python test_hotspot_detection.py
```

测试脚本会：
- 自动查找并匹配GEO和L1文件对
- 验证文件结构是否正确
- 读取并预览3.7μm通道和太阳天顶角数据
- 输出推荐的文件路径配置

### 3. 配置主程序

根据测试脚本的输出，修改`fire_hot.py`中的文件路径设置。

### 4. 运行主程序

```bash
python fire_hot.py
```

主程序会执行完整的火点检测流程，并在`output_hotspots`目录中生成结果。

## 输出结果

### 1. CSV文件

包含检测到的火点信息：
- 纬度（Latitude）
- 经度（Longitude）
- 3.7μm通道亮温（BT37）

### 2. 可视化图像（PNG）

四格拼图，包含：
- 左上角：3.7μm通道亮温图
- 右上角：火点空间分布图（火点用黄色星号标记）
- 左下角：火点掩膜（白色表示火点）
- 右下角：太阳天顶角分布图

## 注意事项

1. **文件匹配**：确保GEO和L1文件的时间戳一致，以保证数据匹配正确
2. **计算资源**：处理大文件时可能需要较多内存，请确保系统资源充足
3. **阈值调整**：根据实际应用场景，可以调整火点检测阈值以平衡检测率和误报率
4. **中国省界**：如果提供了中国省界shapefile文件，可以更清晰地显示火点的地理位置

## 故障排除

1. **文件读取错误**：检查文件路径是否正确，文件是否存在且格式正确
2. **内存错误**：尝试减小网格步长（增大step值）以减少计算量
3. **无火点检测**：可以降低亮温阈值或空间差异阈值，但可能会增加误报
4. **可视化问题**：如果无法显示地理边界，可能是cartopy数据未正确安装

## 优化建议

1. **并行计算**：对于大规模数据处理，可以考虑使用并行计算加速重投影过程
2. **自适应阈值**：根据不同区域和季节特点，动态调整检测阈值
3. **时间序列分析**：结合多时相数据，进一步提高火点检测的准确性
4. **云掩膜处理**：添加云检测模块，减少云对火点识别的影响

## 参考文献

1. 《基于FY-3D_MERSI数据的火点识别方法研究》（殷针针）
2. 《基于FY4遥感数据的森林火灾判别研究》（熊得祥）
3. 《基于风云卫星数据的火情监测研究》
4. FY-4B AGRI数据用户手册